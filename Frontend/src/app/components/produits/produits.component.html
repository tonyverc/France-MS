<!-- MODE LISTE -->
<div *ngIf="displayMode === 'list'" class="container mx-auto p-6">
  <!-- Breadcrumb -->
  <nav class="text-sm mb-4 text-gray-600">
    <a routerLink="/" class="hover:text-blue-500">Accueil</a>
    <span class="mx-2">/</span>
    <span *ngIf="categorieNom">{{ categorieNom }}</span>
    <span *ngIf="sousCategorieNom" class="mx-2">/</span>
    <span *ngIf="sousCategorieNom">{{ sousCategorieNom }}</span>
  </nav>

  <!-- Titre -->
  <h1 class="text-3xl font-bold mb-6">
    {{ sousCategorieNom || categorieNom || 'Produits' }}
  </h1>

  <!-- Grille de produits -->
  <div class="grid md:grid-cols-4 gap-6 mb-8">
    <div 
      *ngFor="let produit of produitsPage"
      class="border rounded-lg p-4 hover:shadow-lg cursor-pointer transition"
      (click)="viewDetail(produit.id)"
    >
      <img 
        [src]="produit.image || 'https://via.placeholder.com/300x200?text=Pas+d\'image'" 
        [alt]="produit.nom"
        class="w-full h-48 object-cover rounded mb-3"
      >
      <h3 class="font-semibold text-lg mb-2">{{ produit.nom }}</h3>
      <p class="text-gray-600 text-sm line-clamp-2">{{ produit.description }}</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center gap-2" *ngIf="totalPages > 1">
    <button 
      (click)="setPage(currentPage - 1)"
      [disabled]="currentPage === 1"
      class="px-4 py-2 border rounded disabled:opacity-50"
    >
      Précédent
    </button>
    
    <button 
      *ngFor="let page of [].constructor(totalPages); let i = index"
      (click)="setPage(i + 1)"
      [class.bg-blue-500]="currentPage === i + 1"
      [class.text-white]="currentPage === i + 1"
      class="px-4 py-2 border rounded hover:bg-gray-100"
    >
      {{ i + 1 }}
    </button>
    
    <button 
      (click)="setPage(currentPage + 1)"
      [disabled]="currentPage === totalPages"
      class="px-4 py-2 border rounded disabled:opacity-50"
    >
      Suivant
    </button>
  </div>
</div>

<!-- MODE DÉTAIL -->
<div *ngIf="displayMode === 'detail' && produitDetail" class="container mx-auto p-6">
  <!-- Bouton retour -->
  <button 
    (click)="backToList()" 
    class="mb-6 flex items-center text-blue-500 hover:text-blue-700 transition"
  >
    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
    </svg>
    Retour à la liste
  </button>

  <!-- Breadcrumb -->
  <nav class="text-sm mb-4 text-gray-600">
    <a routerLink="/" class="hover:text-blue-500">Accueil</a>
    <span class="mx-2">/</span>
    <a 
      *ngIf="produitDetail.sousCategories?.categorie"
      [routerLink]="['/produits/categories', produitDetail.sousCategories.categorie.id]"
      class="hover:text-blue-500"
    >
      {{ produitDetail.sousCategories.categorie.nom }}
    </a>
    <span class="mx-2" *ngIf="produitDetail.sousCategories">/</span>
    <span *ngIf="produitDetail.sousCategories">{{ produitDetail.sousCategories.nom }}</span>
    <span class="mx-2">/</span>
    <span class="font-semibold">{{ produitDetail.nom }}</span>
  </nav>

  <!-- Contenu produit -->
  <div class="grid md:grid-cols-2 gap-8">
    <!-- Image -->
    <div class="border-4 border-gray-300 p-4">
      <img 
        [src]="produitDetail.image || 'https://via.placeholder.com/600x400?text=Pas+d\'image'" 
        [alt]="produitDetail.nom"
        class="w-full rounded-lg shadow-lg"
      >
    </div>
    
    <!-- Informations -->
    <div>
      <h1 class="text-4xl font-bold mb-4">{{ produitDetail.nom }}</h1>
      
      <div class="mb-6">
        <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
          {{ produitDetail.sousCategories.nom }}
        </span>
      </div>
      
      <div class="prose max-w-none mb-6">
        <h2 class="text-xl font-semibold mb-3">Description</h2>
        <div [innerHTML]="produitDetail.description"></div>
      </div>
      
      <!-- Fiche technique -->
      <div *ngIf="produitDetail.fiche_technique" class="mt-8">
        <button 
          (click)="downloadFiche(produitDetail.fiche_technique)"
          class="bg-[#A39F22] text-white px-6 py-3 rounded-lg hover:bg-green-600 transition flex items-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          Télécharger la fiche technique
        </button>
      </div>
      
      <!-- Bouton contact -->
      <div class="mt-6">
        <button 
          routerLink="/contact"
          class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition"
        >
          Demander un devis
        </button>
      </div>
    </div>
  </div>
</div>